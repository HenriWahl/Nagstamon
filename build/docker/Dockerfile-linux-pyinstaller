FROM fedora:42
LABEL maintainer=henri@nagstamon.de

ARG VERSION=0.0.0

# Because it happened that fedora:42 image actually was a fedora:43 image but stayed so
# due to caching the image I add some random characters to force a rebuild of the image if needed:
# 1 2 1 2 keep it on...

# Upgrade first
RUN dnf -y upgrade

# Needed packages for installation and partly building of Python modules
RUN dnf -y install dbus-devel \
                   gcc \
                   glib2-devel \
                   krb5-devel \
                   python3 \
                   python3-devel \
                   python3-virtualenv

# Finally build
CMD cd /nagstamon && \
    virtualenv venv && \
    . venv/bin/activate && \
    pip3 install -r build/requirements/linux.txt && \
    pip3 install pyinstaller && \
    pyinstaller --add-data="Nagstamon/resources:Nagstamon/resources" --noconfirm --name=Nagstamon --onefile --collect-submodules gssapi.raw nagstamon.py && \
    mv /nagstamon/dist/Nagstamon /nagstamon/dist/nagstamon-${VERSION}-linux-x86_64